# Chapter 2 : Shell工具与脚本
## 变量
直接使用等号来定义变量，如
```bash
foo=bar
```
在变量前加上`$`来使用变量的值：
```bash
> echo $foo
bar
```
需注意，在shell中，**空格**被固定用作参数的分隔符，故需慎用。如下，shell将会把foo视作一个函数而试图调用它而非变量名进行赋值，然后因实际不存在foo指令而报错。同样的，在处理名字含有空格的文件是也许小心，注意用引号将名字引起来。
```bash
foo = bar
```
#### 字符串
可以使用双引号`"`或单引号`'`定义字符串。对于纯文本字符串而言，二者等价。但对于一些特殊字符串则略有区别，如含有变量的字符串
```bash
> echo "$foo"
bar
> echo '$foo'
$foo
```
## 函数
```bash
mcd () {
    mkdir -p "$1"
    cd "$1"
}
```
这样便定义了一个名为mcd的函数，他会在当前位置新建一个文件夹并进入其中。我们可以将其写入一个文件中，如`mcd.sh`，并在shell中使用`source mcd.sh`来导入它，而后便可以直接调用'mcd'这个函数。
#### 特殊字符
程序中的`$1`是指在调用mcd时输入的第一个参数。在shell中，有一系列以`$`为首的特殊变量作为系统保留字。如`$1`,`$2`...以此类推分别表示输入的第一，二....个参数。又有`$0`表示脚本的名称，`$?`可以获取上一条命令的错误代码，`$_`可以获得上一条命令的最后一个参数。
还有例如`!!`，它可以用来指代上一条命令，在尝试一些缺权限的东西时很有用，比如当直接输入
```bash
> mkdir /mnt/new
mkdir: /mnt/new: Permission denied
```
由于此时不是root权限，在该处创建文件夹会显示如上提示。此时，可以直接使用
```bash
sudo !!
```
便可直接重新以管理员权限执行。
## Error
在shell中，除了标准输入流与标准输出流，还有标准错误流。它用来输出错误信息而不污染输出。在上文中提及，可用`$?`来获取其中上一条命令的错误代码。如
```bash
> echo "Hello"
Hello
> echo $?
0
```
同大多数主流语言一样，shell也使用0来表示正确无错误的指令。类似的，当尝试执行
```bash
> grep foobar mcd.sh
> echo $?
1
```
由于`mcd.sh`中并不存在`foobar`字符串，便不会输出任何东西耳机报出错误代码1
特殊的，`true`命令的错误代码始终为0，而'false'命令的错误代码始终为1
## 简单的条件语句
除了if-else之外，我们可以利用一些逻辑运算符完成简单的条件语句。例如逻辑或`||`,只有当前面的命令失败，才会执行后面的命令:
```bash
> false || echo "Oops fail"
Oops fail
> true || echo "Will not be printed "
>
```
逻辑与`&&`，当前一条命令失败时，后面的命令将被跳过。
```bash
> true && echo "Things went well"
Things went well
> false && echo "This will not be printed"
>
```
此外，我们可以通过`;`连接两个命令在一行写出。
## 命令替换
使用`$`
```bash
> foo=$(pwd)
```
也可以直接在字符串中展开(注意使用双引号!!)
```bash
> echo "We are in $(pwd)"
We are in /Users/.......
```
## 进程替换
命令替换会将命令结果替换为字符串，而进程替换略有不同。它会将命令的结果保存为一个临时文件，在将其文件路径替换输入。例如:
```bash
> cat <(ls) <(ls ..)
```




